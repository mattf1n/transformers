version: v2
description: natural instructions
tasks:
  - name: test-gptj-train
    image:
      beaker: matthewf/flax-neo
    command: 
      - python
      - run_clm_flax.py
      - --model_name_or_path=EleutherAI/gpt-neo-125M
      - --do_train 
      - --train_file=/data/0.csv
      - --do_eval 
      - --evaluation_strategy=steps
      - --validation_file=/data/0.csv
      - --output_dir=/gpt-neo-125M-contd-00-0
      - --per_device_train_batch_size=4 
      - --num_train_epochs=1
      - --max_eval_samples=100 
      - --max_train_samples=100_000 
      - --save_total_limit=1
      - --overwrite_output_dir 
      - --freeze_wte
      - --report_to 
      - wandb
    datasets:
      - mountPath: /data
        source: 
          beaker: matthewf/the-pile-00
      - mountPath: /config
        source: 
          beaker: matthewf/ds-config-gpt-neo
      - mountPath: /net/nfs.cirrascale
        source:
          hostPath: /net/nfs.cirrascale
    envVars:
      - name: HUB_TOKEN
        secret: HUB_TOKEN
      - name: HF_HOME
        value: /net/nfs.cirrascale/aristo/matthewf/.hf
      - name: NUM_GPUS
        value: 1
    result:
      path: /gpt-neo-125M-contd-00-0
    resources:
      gpuCount: 1
    context:
      cluster: ai2/aristo-cirrascale
      priority: normal
